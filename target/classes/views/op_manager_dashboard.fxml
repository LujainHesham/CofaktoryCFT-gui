<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.text.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>

<AnchorPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.cofaktory.footprint.controllers.OPManagerDashboardController" 
            stylesheets="@styles.css" styleClass="root">
    <BorderPane AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0" AnchorPane.bottomAnchor="0">
        <!-- Header Section -->
        <top>
            <VBox spacing="10">
                <HBox spacing="10" styleClass="dashboard-panel" alignment="CENTER_LEFT">
                    <padding>
                        <Insets top="10" right="15" bottom="10" left="15"/>
                    </padding>
                    <ImageView fitHeight="50.0" fitWidth="50.0" preserveRatio="true">
                        <Image url="@images/coffee_eco_logo.svg" />
                    </ImageView>
                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                        <Label text="Coffee Factory Carbon Tracker" styleClass="heading"/>
                        <Label text="Operational Manager Dashboard" styleClass="sub-heading"/>
                    </VBox>
                    <VBox spacing="5" alignment="CENTER_RIGHT">
                        <Label fx:id="currentUserLabel" styleClass="label"/>
                        <Label fx:id="currentBranchLabel" styleClass="label"/>
                    </VBox>
                    <Button text="Log Out"
                            fx:id="logoutButton"
                            prefWidth="100"
                            onAction="#handleLogout"/>
                </HBox>
            </VBox>
        </top>
        
        <!-- Main Content -->
        <center>
            <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="tab-pane">
                <tabs>
                    <!-- USERS TAB -->
                    <Tab text="Users">
                        <graphic>
                            <ImageView fitHeight="20" fitWidth="20">
                                <Image url="@images/users_icon.svg" />
                            </ImageView>
                        </graphic>
                        <AnchorPane>
                            <VBox spacing="8" AnchorPane.topAnchor="8" AnchorPane.leftAnchor="8" AnchorPane.rightAnchor="8" AnchorPane.bottomAnchor="8">
                                <GridPane hgap="10" vgap="10" styleClass="responsive-container">
                                    <columnConstraints>
                                        <ColumnConstraints minWidth="80" prefWidth="100" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                        <ColumnConstraints minWidth="80" prefWidth="100" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                    </columnConstraints>
                                    
                                    <!-- Row 1 -->
                                    <Label text="User Name:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <TextField fx:id="userNameField" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                                    <Label text="Role:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                                    <ComboBox fx:id="userRoleComboBox" GridPane.columnIndex="3" GridPane.rowIndex="0" maxWidth="Infinity" />
                                    
                                    <!-- Row 2 -->
                                    <Label text="Email:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <TextField fx:id="userEmailField" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                    <Label text="Password:" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                                    <PasswordField fx:id="userPasswordField" GridPane.columnIndex="3" GridPane.rowIndex="1" />
                                    
                                    <!-- Row 3 -->
                                    <Label text="Branch:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                                    <ComboBox fx:id="branchComboBox" visible="false" promptText="Select Branch" GridPane.columnIndex="1" 
                                              GridPane.rowIndex="2" GridPane.columnSpan="3" maxWidth="Infinity" />
                                </GridPane>
                                
                                <HBox spacing="8" styleClass="responsive-container">
                                    <Button text="Add" onAction="#handleAddUser" />
                                    <Button text="Delete" onAction="#handleDeleteUser" styleClass="button-danger" />
                                    <Button text="Save" onAction="#handleSaveUser" styleClass="button-eco" />
                                    <Button text="Reset Password" onAction="#handleResetPassword" />
                                    <Button text="Refresh" onAction="#handleRefreshUser" />
                                </HBox>
                                
                                <TableView fx:id="userTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="userIDColumn" text="User ID" prefWidth="70"/>
                                        <TableColumn fx:id="userNameColumn" text="Name" prefWidth="120"/>
                                        <TableColumn fx:id="userRoleColumn" text="Role" prefWidth="90"/>
                                        <TableColumn fx:id="userEmailColumn" text="Email" prefWidth="150"/>
                                        <TableColumn fx:id="userPasswordColumn" text="Password" prefWidth="120"/>
                                        <TableColumn fx:id="userBranchIDColumn" text="Branch ID" prefWidth="90"/>
                                        <TableColumn fx:id="forcePasswordChangeColumn" text="Force Password Change" prefWidth="120"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </AnchorPane>
                    </Tab>
                    
                    <!-- BRANCHES TAB -->
                    <Tab text="Branches">
                        <graphic>
                            <ImageView fitHeight="20" fitWidth="20">
                                <Image url="@images/branches_icon.svg" />
                            </ImageView>
                        </graphic>
                        <AnchorPane>
                            <VBox spacing="8" AnchorPane.topAnchor="8" AnchorPane.leftAnchor="8" AnchorPane.rightAnchor="8" AnchorPane.bottomAnchor="8">
                                <GridPane hgap="10" vgap="10" styleClass="responsive-container">
                                    <columnConstraints>
                                        <ColumnConstraints minWidth="80" prefWidth="100" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                        <ColumnConstraints minWidth="120" prefWidth="140" />
                                        <ColumnConstraints minWidth="120" prefWidth="150" hgrow="ALWAYS" />
                                    </columnConstraints>
                                    
                                    <Label text="City:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <ComboBox fx:id="cityComboBox" promptText="Select City" GridPane.columnIndex="1" GridPane.rowIndex="0" maxWidth="Infinity" />
                                    <Label text="Location:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                                    <TextField fx:id="branchLocationField" GridPane.columnIndex="3" GridPane.rowIndex="0" />
                                    
                                    <Label text="Num Employees:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <TextField fx:id="branchNumEmployeesField" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                </GridPane>
                                
                                <HBox spacing="8" styleClass="responsive-container">
                                    <Button text="Add" onAction="#handleAddBranch" />
                                    <Button text="Delete" onAction="#handleDeleteBranch" styleClass="button-danger" />
                                    <Button text="Save" onAction="#handleSaveBranch" styleClass="button-eco" />
                                    <Button text="Refresh" onAction="#handleRefreshBranch" />
                                </HBox>
                                
                                <TableView fx:id="branchTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="branchIDColumn4" text="Branch ID" prefWidth="80"/>
                                        <TableColumn fx:id="cityIDColumn" text="City ID" prefWidth="80"/>
                                        <TableColumn fx:id="locationColumn" text="Location" prefWidth="120"/>
                                        <TableColumn fx:id="numEmployeesColumn" text="Num Employees" prefWidth="120"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </AnchorPane>
                    </Tab>
    
                    <!-- PRODUCTION TAB -->
                    <Tab text="Production">
                        <graphic>
                            <ImageView fitHeight="20" fitWidth="20">
                                <Image url="@images/production_icon.svg" />
                            </ImageView>
                        </graphic>
                        <AnchorPane>
                            <VBox spacing="8" AnchorPane.topAnchor="8" AnchorPane.leftAnchor="8" AnchorPane.rightAnchor="8" AnchorPane.bottomAnchor="8">
                                <GridPane hgap="10" vgap="10" styleClass="responsive-container">
                                    <columnConstraints>
                                        <ColumnConstraints minWidth="80" prefWidth="100" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                        <ColumnConstraints minWidth="80" prefWidth="100" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                    </columnConstraints>
                                    
                                    <Label text="Supplier:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <TextField fx:id="supplierField" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                                    <Label text="Coffee Type:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                                    <ComboBox fx:id="coffeeTypeComboBox" GridPane.columnIndex="3" GridPane.rowIndex="0" maxWidth="Infinity" />
                                    
                                    <Label text="Product Type:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <ComboBox fx:id="productTypeComboBox" GridPane.columnIndex="1" GridPane.rowIndex="1" maxWidth="Infinity" />
                                    <Label text="Quantity (kg):" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                                    <TextField fx:id="quantityField" GridPane.columnIndex="3" GridPane.rowIndex="1" />
                                    
                                    <Label text="Date:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                                    <DatePicker fx:id="productionDatePicker" GridPane.columnIndex="1" GridPane.rowIndex="2" maxWidth="Infinity" />
                                </GridPane>
                                
                                <HBox spacing="8" styleClass="responsive-container">
                                    <Button text="Delete" onAction="#handleDeleteProduction" styleClass="button-danger" />
                                    <Button text="Save" onAction="#handleSaveProduction" styleClass="button-eco" />
                                    <Button text="Refresh" onAction="#handleRefreshProduction" />
                                </HBox>
                                
                                <TableView fx:id="productionTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="productionIDColumn" text="Production ID" prefWidth="90"/>
                                        <TableColumn fx:id="productionBranchIDColumn" text="Branch ID" prefWidth="75"/>
                                        <TableColumn fx:id="productionUserIDColumn" text="User ID" prefWidth="75"/>
                                        <TableColumn fx:id="supplierColumn" text="Supplier" prefWidth="100"/>
                                        <TableColumn fx:id="coffeeTypeColumn" text="Coffee Type" prefWidth="100"/>
                                        <TableColumn fx:id="productTypeColumn" text="Product Type" prefWidth="100"/>
                                        <TableColumn fx:id="quantityColumn" text="Quantity (kg)" prefWidth="100"/>
                                        <TableColumn fx:id="prCarbonEmissionsColumn" text="CO₂ Emissions (kg)" prefWidth="120"/>
                                        <TableColumn fx:id="productionDateColumn" text="Date" prefWidth="100"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </AnchorPane>
                    </Tab>
                    
                    <!-- PACKAGING TAB -->
                    <Tab text="Packaging">
                        <graphic>
                            <ImageView fitHeight="20" fitWidth="20">
                                <Image url="@images/packaging_icon.svg" />
                            </ImageView>
                        </graphic>
                        <AnchorPane>
                            <VBox spacing="8" AnchorPane.topAnchor="8" AnchorPane.leftAnchor="8" AnchorPane.rightAnchor="8" AnchorPane.bottomAnchor="8">
                                <GridPane hgap="10" vgap="10" styleClass="responsive-container">
                                    <columnConstraints>
                                        <ColumnConstraints minWidth="150" prefWidth="150" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                        <ColumnConstraints minWidth="80" prefWidth="100" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                    </columnConstraints>
                                    
                                    <Label text="Packaging Waste (kg):" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <TextField fx:id="packagingWasteField" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                                    <Label text="Date:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                                    <DatePicker fx:id="packagingDatePicker" GridPane.columnIndex="3" GridPane.rowIndex="0" maxWidth="Infinity" />
                                </GridPane>
                                
                                <HBox spacing="8" styleClass="responsive-container">
                                    <Button text="Delete" onAction="#handleDeletePackaging" styleClass="button-danger" />
                                    <Button text="Save" onAction="#handleSavePackaging" styleClass="button-eco" />
                                    <Button text="Refresh" onAction="#handleRefreshPackaging" />
                                </HBox>
                                
                                <TableView fx:id="packagingTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="packagingIDColumn" text="Packaging ID" prefWidth="90"/>
                                        <TableColumn fx:id="packagingBranchIDColumn" text="Branch ID" prefWidth="80"/>
                                        <TableColumn fx:id="packagingUserIDColumn" text="User ID" prefWidth="80"/>
                                        <TableColumn fx:id="packagingWasteColumn" text="Waste (kg)" prefWidth="100"/>
                                        <TableColumn fx:id="paCarbonEmissionsColumn" text="CO₂ Emissions (kg)" prefWidth="120"/>
                                        <TableColumn fx:id="packagingDateColumn" text="Date" prefWidth="100"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </AnchorPane>
                    </Tab>
                    
                    <!-- DISTRIBUTION TAB -->
                    <Tab text="Distribution">
                        <graphic>
                            <ImageView fitHeight="20" fitWidth="20">
                                <Image url="@images/distribution_icon.svg" />
                            </ImageView>
                        </graphic>
                        <AnchorPane>
                            <VBox spacing="8" AnchorPane.topAnchor="8" AnchorPane.leftAnchor="8" AnchorPane.rightAnchor="8" AnchorPane.bottomAnchor="8">
                                <GridPane hgap="10" vgap="10" styleClass="responsive-container">
                                    <columnConstraints>
                                        <ColumnConstraints minWidth="120" prefWidth="150" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                        <ColumnConstraints minWidth="150" prefWidth="150" />
                                        <ColumnConstraints minWidth="150" prefWidth="200" hgrow="ALWAYS" />
                                    </columnConstraints>
                                    
                                    <Label text="Vehicle Type:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <ComboBox fx:id="vehicleTypeComboBox" GridPane.columnIndex="1" GridPane.rowIndex="0" maxWidth="Infinity" />
                                    <Label text="Number of Vehicles:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                                    <TextField fx:id="numberOfVehiclesField" GridPane.columnIndex="3" GridPane.rowIndex="0" />
                                    
                                    <Label text="Distance per Vehicle (km):" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <TextField fx:id="distancePerVehicleField" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                    <Label text="Date:" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                                    <DatePicker fx:id="distributionDatePicker" GridPane.columnIndex="3" GridPane.rowIndex="1" maxWidth="Infinity" />
                                </GridPane>
                                
                                <HBox spacing="8" styleClass="responsive-container">
                                    <Button text="Delete" onAction="#handleDeleteDistribution" styleClass="button-danger" />
                                    <Button text="Save" onAction="#handleSaveDistribution" styleClass="button-eco" />
                                    <Button text="Refresh" onAction="#handleRefreshDistribution" />
                                </HBox>
                                
                                <TableView fx:id="distributionTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="distributionIDColumn" text="Distribution ID" prefWidth="90"/>
                                        <TableColumn fx:id="distributionBranchIDColumn" text="Branch ID" prefWidth="80"/>
                                        <TableColumn fx:id="distributionUserIDColumn" text="User ID" prefWidth="80"/>
                                        <TableColumn fx:id="vehicleTypeColumn" text="Vehicle Type" prefWidth="110"/>
                                        <TableColumn fx:id="numberOfVehiclesColumn" text="Num Vehicles" prefWidth="100"/>
                                        <TableColumn fx:id="distancePerVehicleColumn" text="Dist/Vehicle (km)" prefWidth="110"/>
                                        <TableColumn fx:id="totalDistanceColumn" text="Total Dist (km)" prefWidth="110"/>
                                        <TableColumn fx:id="fuelEfficiencyColumn" text="Fuel Eff." prefWidth="80"/>
                                        <TableColumn fx:id="vCarbonEmissionsColumn" text="CO₂ Emissions (kg)" prefWidth="120"/>
                                        <TableColumn fx:id="distributionDateColumn" text="Date" prefWidth="100"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </AnchorPane>
                    </Tab>
                    
                    <!-- REPORT TAB -->
                    <Tab text="Report">
                        <graphic>
                            <ImageView fitHeight="20" fitWidth="20">
                                <Image url="@images/coffee_eco_logo.svg" />
                            </ImageView>
                        </graphic>
                        <AnchorPane>
                            <VBox spacing="12" AnchorPane.topAnchor="12" AnchorPane.leftAnchor="12" AnchorPane.rightAnchor="12" AnchorPane.bottomAnchor="12">
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <ImageView fitHeight="24.0" fitWidth="24.0" preserveRatio="true">
                                        <Image url="@images/coffee_eco_logo.svg" />
                                    </ImageView>
                                    <Label text="Carbon Footprint Reports" styleClass="heading" />
                                </HBox>
                                
                                <Label text="Select a branch to generate its carbon report:" styleClass="sub-heading" />
                                
                                <TableView fx:id="reportBranchTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="reportBranchIdColumn" text="Branch ID" prefWidth="100"/>
                                        <TableColumn fx:id="reportBranchLocationColumn" text="Location" prefWidth="160"/>
                                    </columns>
                                </TableView>
                                
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Button text="Generate PDF Report" onAction="#handleGenerateBranchReport" styleClass="button-eco" />
                                    <Label fx:id="reportStatusLabel" text="" style="-fx-text-fill: green;"/>
                                </HBox>
                            </VBox>
                        </AnchorPane>
                    </Tab>
                </tabs>
            </TabPane>
        </center>
        
        <!-- Footer Section -->
        <bottom>
            <HBox alignment="CENTER_RIGHT" spacing="10" styleClass="dashboard-panel">
                <padding>
                    <Insets top="5" right="15" bottom="5" left="15"/>
                </padding>
                <Label text="© 2024 CofaktoryCFT - Carbon Footprint Tracker" />
            </HBox>
        </bottom>
    </BorderPane>
</AnchorPane>